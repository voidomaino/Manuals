# 输入与输出

数据的输入输出是程序必不可少的功能。数据输入是指通过计算机外部设备将数据输入计算机内部存储器中的过程，又相应的输入语句完成；数据输出是指将计算机内部存储器中的有关数据通过计算机外部设备输出的过程，由相应的输出语句完成。

输入和输出的三个必备要素：

1. 数据本身；
2. 输入、输出的格式；
3. 输入、输出的设备。

根据三要素的不同，Fortran 提供三种类型的输入输出方式：

1. 系统隐含的标准格式（表控输入与输出）；
2. 用户指定的格式；
3. 二进制格式。

## 表控输入与输出

系统的隐含标准格式非常简单，数据按照合法形式表示，数据之间用回车、空格或逗号分开。

### READ

```BNF
<表控输入语句> ::= read *[,<输入表>]
<输入表> ::= <变量>{,<变量>}
```

执行 `read` 语句，将从默认输入设备（键盘）读取数据并依次赋值到对应位置的变量上。

同一个输入表内可以包括不同类型的变量。

对于数值型变量，每个 `read` 语句从新的一行读取数据，输入数据超过变量的数量，超出部分被舍弃。

对于字符型变量，每个字符串操作都占用一行，下一行接着变量列表的下一个变量。

在输入过程中，用符号 `/` 结束执行输入，未被输入的数据保持不变。

用两个逗号表示输入空数据。

用乘号重复输入数据，形式为：

```BNF
<重复输入格式> ::= <整数>*"[" <需要重复输入的数据> "]"
```

### PRINT

```BNF
<表控输出语句> ::= print *[,<输出表>]
<输出表> ::= <表达式>{,<表达式>}
```

数据输出的注意事项和 `read` 类似，重点是数据输出的格式：

输出的数据按系统规定的**域宽**输出，数据之间间隔一个空格，

整型数据：右对齐输出。

`kind=1` 域宽为 4

`kind=2` 域宽为 6

`kind=4` 域宽为 11

`kind=8` 域宽为 21

实型数据：小数形式左对齐；指数形式数值部分左对齐，指数部分右对齐，

`kind=4` 总域宽为 14 数值部分占 10 指数部分占 4

`kind=8` 总域宽为 23 数值部分占 18 指数部分占 5

字符型数据：域宽为输出表中的表达式长度。

逻辑型数据：域宽为 1，`.TURE.` 输出为 `T`；`.FALSE.` 输出为 `F`。

## FORMAT

有格式的输入输出语句描述如下

```BNF
<有格式的输入语句> ::=
 read <语句标号>,<输入表>|
 read """<格式说明表>""",<输入表>|
 read "(" *,<语句标号> ")"<输入表>|
 read "(" *,"""<格式说明表>""" ")"<输入表>
<有格式的输出语句> ::=
 print <语句标号>,<输出表>|
 print """<格式说明表>""",<输出表>|
 write "(" *,<语句标号> ")"<输出表>|
 write "(" *,"""<格式说明表>""" ")"<输出表>
```

`format` 语句成为格式说明语句，用以描述输入输出的格式。

```BNF
<format 语句> ::= <语句标号> format <格式说明表>
<格式说明表> ::= "("<格式说明>{[,|/]<格式说明>}")"
<格式说明> ::= 
 <整型格式说明> | 
 <实型格式说明> | 
 <复型格式说明> | 
 <字符型格式说明> | 
 <逻辑型格式说明> | 
 <位置格式说明> | 
 <其他格式说明> 
```

`格式说明` 由格式编辑符构成，以下是格式编辑符的表达方式、名称、作用。

### 整数的输入输出

| 表达方式    | 名称       | 功能                         | 输入 | 输出 |
| ----------- | ---------- | ---------------------------- | ---- | ---- |
| `[r]Iw[.m]` | 整型编辑符 | 将整数按照指定的域宽输入输出 | √    | √    |

`[r]` 表示重复次数，`w`表示整数输入输出域宽，`m` 为最少输出位数。

（1）输入

逗号具有最高优先级，其次是域宽，空格在域宽之后失效；数据范围和类型对应，否则报错。

（2）输出

输出时域宽具有最高优先级，右对齐，宽度超过域宽则填满 `*`。

最后根据最少输出位数在空格内填补 `0`，直到数值部分的位数为 m。符号不包括在内。

### 实数的输入输出

（1）小数

| 表达方式  | 名称           | 功能                           | 输入 | 输出 |
| --------- | -------------- | ------------------------------ | ---- | ---- |
| `[r]Fw.d` | 小数实型编辑符 | 将小数型实数按指定域宽输入输出 | √    | √    |

`[r]` 表示重复次数，`w` 表示整数输入输出总的域宽，`d` 表示小数的位数。

1）输入

逗号具有最高优先级，其次是域宽，空格在域宽之后失效，接下来看小数点，没有则根据 `d` 值强行添加小数点；数据范围和类型对应，否则报错。

2）输出

输出时先四舍五入小数部分到 `d`，没有的填补 `0`，超过域宽则填满 `*`；在域宽之内则右对齐。

（2）指数

| 表达方式      | 名称             | 功能                                 | 输入 | 输出 |
| ------------- | ---------------- | ------------------------------------ | ---- | ---- |
| `[r]Ew.d[Ee]` | 指数实型编辑符   | 将指数型实数按指定域宽输入输出       | √    | √    |
| `[r]Dw.d`     | 双精度实型编辑符 | 将双精度指数型实数按指定域宽输入输出 | √    | √    |

`[r]` 表示重复次数，`w` 表示整数输入输出总的域宽，`d` 表示小数的位数。

1）输入

逗号具有最高优先级，其次是域宽，空格在域宽之后失效，接下来看输入的字母位置，前面的部分用小数处理。指数要满足对应的范围和精度。

2）输出

输出时先将数据转化为数值部分满足 $0 \sim 1$ 的指数形式实数；指数部分保留四个域宽，写为 `E+xx`（当 `kind = 8` 时就是五个）；对数值部分，四舍五入或者补全到小数点后第 `d` 位，塞进剩余的域宽之中，小数点占一位，负号占一位，`0` 可以省略，不省略就要补全；如果塞不下就填满 `*`；右对齐。

### 复数的输入输出

复数的输入输出编辑符通过两个实行编辑符实现，一个复数需要两个实数输入，依次赋值给实部和虚部，输出的时候也需要两个实数输出编辑符。

### 字符串的输入输出

| 表达方式  | 名称         | 功能                       | 输入 | 输出 |
| --------- | ------------ | -------------------------- | ---- | ---- |
| `[r]A[w]` | 字符型编辑符 | 将字符串按指定域宽输入输出 | √    | √    |
| `'', ""`  | 字符串编辑符 | 输出字符串                 |      | √    |

（1）输入

如果没有指定域宽，则以输入输出表中的变量或表达式的长度为域宽；域宽和长度不同，则先根据域宽截取，长度多余则考虑补充空格，域宽多余则以右对齐原则赋值。

（2）输出

同样域宽小则截取，域宽大则右对齐。

字符串编辑符可以直接作为编辑符插入到格式说明表中，内部的字符串直接显示。

### 逻辑值的输入输出

| 表达方式 | 名称         | 功能                       | 输入 | 输出 |
| -------- | ------------ | -------------------------- | ---- | ---- |
| `[r]Lw`  | 逻辑型编辑符 | 将逻辑值按指定域宽输入输出 | √    | √    |

域宽缺省为 `2`。

（1）输入

域宽内出现的第一个 `T(t)` 或 `F(f)` 决定输入的值，如需要分隔，应使用逗号而不空格。

（2）输出

在对应的域宽内右对齐输出 `T` 或 `F`。

### 二进制数据的输入、输出

| 表达方式    | 名称           | 功能                                 | 输入 | 输出 |
| ----------- | -------------- | ------------------------------------ | ---- | ---- |
| `[r]Bw[.m]` | 二进制编辑符   | 将二进制整数按照指定的域宽输入输出   | √    | √    |
| `[r]Ow[.m]` | 八进制编辑符   | 将八进制整数按照指定的域宽输入输出   | √    | √    |
| `[r]Zw[.m]` | 十六进制编辑符 | 将十六进制整数按照指定的域宽输入输出 | √    | √    |

这三个编辑符可以根据变量的类型输入或输出整型、实型、复型、字符型和逻辑型数据。

输入时，按域宽截取数据，去掉空格；

输出时，右对齐，填满 `*`，补齐 `0`。

### 输入输出的排版格式

| 表达方式     | 名称           | 功能                                                         | 输入 | 输出 |
| ------------ | -------------- | ------------------------------------------------------------ | ---- | ---- |
| `nH`         | H 编辑符       |                                                              |      |      |
| `Q`          | 字符计数编辑符 | 获取下一项字符串输入的长度赋值给对应的变量                   | √    |      |
| `Tn`         | 位置编辑符     | 下一个输入或输出从本行的第 n 个字符开始算起；                |      |      |
| `TLn`        | 位置编辑符     | 下一个输入或输出从光标左边的第 n 个字符开始算起              |       |      |
| `TRn`        | 位置编辑符     | 下一个输入或输出从光标右边间隔 n 个字符开始算起              |      |      |
| `nX`         | 位置编辑符     | 输入时，跳过 n 个字符；输出时，插入 n 个空格                 | √    | √    |
| `SP,SS,S`    | + 编辑符       |                                                              |      |      |
| `/`          | 斜杠编辑符     | 结束本行，从下一行开始                                       | √    | √    |
| `\`          | 反斜杠编辑符   | 下一行和本行连接                                             |      | √    |
| `$`          | $ 编辑符       | 下一行和本行连接                                             |      | √    |
| `:`          | 格式控制编辑符 | 冒号前的输出向完成之后马上结束输出                           |      | √    |
| `kP`         | 比例因子编辑符 |                                                              |      |      |
| `BN,BZ`      | 空格替代编辑符 |                                                              |      |      |
